{% extends "base.html" %}

{% block page_title %}{{ employee.name }} ë‹˜ ê¸‰ì—¬ ëª…ì„¸ ìƒì„¸{% endblock %}

{% block page_content %}
<div class="card" style="grid-column: 1 / 3;">
    <div class="card-header employee-list-header">
        <span>{{ employee.name }} ë‹˜ {{ record.pay_date }} ê¸‰ì—¬ ëª…ì„¸ì„œ</span>
        <a href="{{ url_for('salary_management') }}" class="sub-action-btn header-btn">ğŸ”™ ê¸‰ì—¬ ê´€ë¦¬ ëª©ë¡ìœ¼ë¡œ</a>
    </div>

    <div class="card-body">

        {# --------------------- ê¸°ë³¸ ì •ë³´ ìš”ì•½ --------------------- #}
        <h4 style="margin-bottom: 15px;">ì§€ê¸‰ ìš”ì•½</h4>
        <table class="employee-detail-table" style="width: 100%; max-width: 600px; margin-bottom: 30px;">
            <tr>
                <th>ì§€ê¸‰ ì—°ì›”</th>
                <td><strong>{{ record.pay_date }}</strong></td>
            </tr>
            <tr>
                <th>ì§€ê¸‰ ëŒ€ìƒ</th>
                <td>{{ employee.name }} ({{ employee.department }} / {{ employee.position }})</td>
            </tr>
            <tr>
                <th>ì´ ì§€ê¸‰ì•¡ (Gross Pay)</th>
                <td style="color: #2c3e50; font-weight: bold;">{{ "{:,}".format(record.gross_pay) }}ì›</td>
            </tr>
            <tr>
                <th>ì´ ê³µì œì•¡ (Deductions)</th>
                <td style="color: #e74c3c; font-weight: bold;">- {{ "{:,}".format(record.deductions) }}ì›</td>
            </tr>
            <tr>
                <th>ì‹¤ ìˆ˜ë ¹ì•¡ (Net Pay)</th>
                <td style="font-size: 1.2em; color: #2ecc71; font-weight: bold;">{{ "{:,}".format(record.net_pay) }}ì›</td>
            </tr>
        </table>
        
        {# --------------------- ìƒì„¸ ì§€ê¸‰ ë‚´ì—­ (ì„ì‹œ) --------------------- #}
        <h4 style="margin-bottom: 15px;">ì§€ê¸‰/ê³µì œ ìƒì„¸ ë‚´ì—­</h4>
        <div style="display: flex; gap: 40px;">
            
            {# ì§€ê¸‰ ë‚´ì—­ #}
            <div style="flex: 1;">
                <h5 style="border-bottom: 2px solid #2ecc71; padding-bottom: 5px; color: #2ecc71;">ì§€ê¸‰ ë‚´ì—­</h5>
                <table class="employee-table" style="width: 100%;">
                    <tr><th>êµ¬ë¶„</th><th style="text-align: right;">ê¸ˆì•¡ (ì›)</th></tr>
                    <tr><td>ê¸°ë³¸ê¸‰</td><td style="text-align: right;">{{ "{:,}".format(record.gross_pay - record.allowance - record.bonus) }}</td></tr>
                    <tr><td>ê³ ì • ìˆ˜ë‹¹</td><td style="text-align: right;">{{ "{:,}".format(record.allowance) }}</td></tr>
                    <tr><td>ë³´ë„ˆìŠ¤/ì„±ê³¼ê¸‰</td><td style="text-align: right;">{{ "{:,}".format(record.bonus) }}</td></tr>
                    <tr style="background-color: #f5f5f5; font-weight: bold;">
                        <td>í•©ê³„</td>
                        <td style="text-align: right;">{{ "{:,}".format(record.gross_pay) }}</td>
                    </tr>
                </table>
            </div>

            {# ê³µì œ ë‚´ì—­ #}
            <div style="flex: 1;">
                <h5 style="border-bottom: 2px solid #e74c3c; padding-bottom: 5px; color: #e74c3c;">ê³µì œ ë‚´ì—­</h5>
                <table class="employee-table" style="width: 100%;">
                    <tr><th>êµ¬ë¶„</th><th style="text-align: right;">ê¸ˆì•¡ (ì›)</th></tr>
                    {# ì‹¤ì œ DB í•„ë“œê°€ ì—†ìœ¼ë¯€ë¡œ, ê³µì œì•¡ì„ ì„ì‹œë¡œ ì†Œë“ì„¸ì™€ ê¸°íƒ€ë¡œ ë‚˜ëˆ” #}
                    <tr><td>ì†Œë“ì„¸</td><td style="text-align: right;">{{ "{:,}".format( (record.deductions * 0.7) | round | int) }}</td></tr>
                    <tr><td>4ëŒ€ ë³´í—˜ë£Œ ë“±</td><td style="text-align: right;">{{ "{:,}".format( (record.deductions * 0.3) | round | int) }}</td></tr>
                    <tr><td>ê¸°íƒ€ ê³µì œ</td><td style="text-align: right;">0</td></tr>
                    <tr style="background-color: #f5f5f5; font-weight: bold;">
                        <td>í•©ê³„</td>
                        <td style="text-align: right;">{{ "{:,}".format(record.deductions) }}</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <h4 style="margin-top: 30px; margin-bottom: 10px;">ë¹„ê³ </h4>
        <div style="padding: 15px; border: 1px solid #eee; border-radius: 8px; background-color: #f9f9f9;">
            {{ record.memo if record.memo else 'íŠ¹ì´ ì‚¬í•­ ì—†ìŒ.' }}
        </div>
        
        {% if g.user.role == 'admin' %}
        <div style="margin-top: 20px; text-align: right;">
            {# TODO: ëª…ì„¸ì„œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ #}
            <button class="danger-action-btn header-btn" onclick="alert('TODO: ëª…ì„¸ì„œ ì‚­ì œ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.')">ì‚­ì œ</button>
        </div>
        {% endif %}
        
    </div>
</div>
{% endblock %}