{% extends "base.html" %}

{% block title %}설정 관리{% endblock %}

{% block page_content %}

<div class="card">
    <div class="card-header">
        <span>부서 관리</span>
    </div>
    <div class="card-body">
        <h4>새 부서 추가</h4>
        <form method="POST" action="{{ url_for('add_department') }}">
            <div style="display: flex; gap: 10px; margin-bottom: 5px;">
                <input type="text" name="new_department_name" placeholder="새 부서명" required style="flex-grow: 1;">
                <input type="text" name="new_department_code" placeholder="부서 코드 (2자리)" required maxlength="2" style="width: 120px;">
            </div>
            <button type="submit" class="btn sub-action-btn" style="width: 100%;">추가</button>
        </form>
        <hr>
        <h4>현재 부서 목록</h4>
        <ul class="settings-list">
            {% for dept in departments %}
            <li>
                <span>{{ dept['name'] }} ({{ dept['code'] }})</span>
                <div class="button-group">
                    <button class="btn sub-action-btn edit-btn" onclick="openDeptEditModal('{{ dept['name'] }}', '{{ dept['code'] }}')">수정</button>
                    <form method="POST" action="{{ url_for('delete_department', dept_name=dept['name']) }}" onsubmit="return confirm('정말로 \'{{ dept['name'] }}\' 부서를 삭제하시겠습니까?');">
                        <button type="submit" class="danger-action-btn">삭제</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div id="editDeptModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeDeptEditModal()">&times;</span>
        <h3>부서 정보 수정</h3>
        <form method="POST" action="{{ url_for('edit_department') }}">
            <input type="hidden" id="original_dept_name" name="original_dept_name">
            <div class="form-group">
                <label for="new_dept_name_modal">새 부서명</label>
                <input type="text" id="new_dept_name_modal" name="new_dept_name" required>
            </div>
            <div class="form-group">
                <label for="new_dept_code_modal">새 부서 코드 (2자리)</label>
                <input type="text" id="new_dept_code_modal" name="new_dept_code" required maxlength="2">
            </div>
            <button type="submit" class="btn main-action-btn">수정 완료</button>
        </form>
    </div>
</div>


<div class="card">
    <div class="card-header">
        <span>직급 및 기본급 관리</span>
    </div>
    <div class="card-body">
        <h4>새 직급 추가</h4>
        <form method="POST" action="{{ url_for('add_position') }}" style="display: flex; gap: 10px;">
            <input type="text" name="new_position" placeholder="새 직급명" required style="flex-grow: 1;">
            <button type="submit" class="btn sub-action-btn">추가</button>
        </form>
        <hr>
        <h4>현재 직급 목록 (기본급)</h4>
        <ul class="settings-list">
            {% for pos in positions %}
            <li>
                <span>{{ pos['name'] }} (기본급: {{ "{:,.0f}원".format(pos['base_salary']) }})</span>
                <div class="button-group">
                    <button class="btn sub-action-btn edit-btn" 
                            onclick="openPosEditModal('{{ pos['name'] }}', '{{ pos['base_salary'] }}')">수정</button>
                    <form method="POST" action="{{ url_for('delete_position', pos_name=pos['name']) }}" onsubmit="return confirm('정말로 \'{{ pos['name'] }}\' 직급을 삭제하시겠습니까?');">
                        <button type="submit" class="danger-action-btn">삭제</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div id="editPosModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closePosEditModal()">&times;</span>
        <h3>직급 정보 수정</h3>
        <form method="POST" action="{{ url_for('edit_position') }}">
            <input type="hidden" id="original_pos_name" name="original_pos_name">
            <div class="form-group">
                <label for="new_pos_name_modal">직급명</label>
                <input type="text" id="new_pos_name_modal" name="new_pos_name" required>
            </div>
            <div class="form-group">
                <label for="new_base_salary_modal">기본급 (월)</label>
                <input type="number" id="new_base_salary_modal" name="new_base_salary" required placeholder="숫자만 입력 (예: 3000000)">
            </div>
            <button type="submit" class="btn main-action-btn">수정 완료</button>
        </form>
    </div>
</div>




<script>
    // --- 1. 부서 수정 모달 (기존 코드) ---
    const deptModal = document.getElementById('editDeptModal');
    function openDeptEditModal(name, code) {
        document.getElementById('original_dept_name').value = name;
        document.getElementById('new_dept_name_modal').value = name;
        document.getElementById('new_dept_code_modal').value = code;
        deptModal.style.display = "block";
    }
    function closeDeptEditModal() {
        deptModal.style.display = "none";
    }

    // --- 2. [신규] 직급 수정 모달 ---
    const posModal = document.getElementById('editPosModal');
    function openPosEditModal(name, salary) {
        document.getElementById('original_pos_name').value = name;
        document.getElementById('new_pos_name_modal').value = name;
        document.getElementById('new_base_salary_modal').value = salary;
        posModal.style.display = "block";
    }
    function closePosEditModal() {
        posModal.style.display = "none";
    }

    // --- 3. 모달 외부 클릭 시 닫기 (수정) ---
    window.onclick = function(event) {
        if (event.target == deptModal) {
            closeDeptEditModal();
        }
        if (event.target == posModal) {
            closePosEditModal();
        }
    }
</script>

{% endblock %}