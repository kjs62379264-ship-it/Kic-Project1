{% extends "base.html" %}

{% block title %}ê·¼íƒœ ìš”ì²­ ì²˜ë¦¬{% endblock %}
{% block page_body_class %}attendance-request-page{% endblock %}

{% block page_content %}

<div class="request-vertical-split-container" 
     style="grid-column: 1 / 3; display: flex; flex-direction: column; gap: 20px; height: 100%;"> 

    <div class="card" style="flex-grow: 1; display: flex; flex-direction: column;">
        <div class="card-header">
            <span style="color: #e67e22; font-weight: bold;">â³ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡</span>
        </div>
        
        <div class="card-body" style="flex-grow: 1; overflow-y: auto; padding: 10px 20px;">
            
            <div style="display: flex; justify-content: space-around; padding: 10px; border: 1px solid #eee; border-radius: 8px; background-color: #fcfcfc; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <p style="margin: 0; font-weight: bold; color: #555;">ì´ ìš”ì²­ ê±´ìˆ˜</p>
                    <h3 style="margin: 5px 0 0; color: #3498db;">{{ request_counts.TOTAL }}ê±´</h3>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-weight: bold; color: #e67e22;">í˜„ì¬ ëŒ€ê¸° ì¤‘</p>
                    <h3 style="margin: 5px 0 0; color: #e67e22;">{{ request_counts['ëŒ€ê¸°'] }}ê±´</h3>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-weight: bold; color: #2ecc71;">ì´ ìŠ¹ì¸ ì™„ë£Œ</p>
                    <h3 style="margin: 5px 0 0; color: #2ecc71;">{{ request_counts['ìŠ¹ì¸'] }}ê±´</h3>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-weight: bold; color: #e74c3c;">ì´ ë°˜ë ¤ ì²˜ë¦¬</p>
                    <h3 style="margin: 5px 0 0; color: #e74c3c;">{{ request_counts['ë°˜ë ¤'] }}ê±´</h3>
                </div>
            </div>
            
            <table class="employee-table">
                <thead>
                    <tr>
                        <th style="width: 15%;">ì‹ ì²­ì¸</th>
                        <th style="width: 10%;">ë¶€ì„œ</th>
                        <th style="width: 10%;">ìœ í˜•</th>
                        <th style="width: 25%;">ê¸°ê°„</th>
                        <th>ì‚¬ìœ </th>
                        <th style="width: 15%; text-align: center;">ì²˜ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                {% for req in pending_requests %}
                    <tr>
                        <td>{{ req.name }}</td>
                        <td>{{ req.department }}</td>
                        <td style="font-weight: bold; color: #3498db;">{{ req.request_type }}</td>
                        <td>{{ req.start_date }} ~ {{ req.end_date }}</td>
                        <td style="text-align: left;">{{ req.reason }}</td>
                        <td style="text-align: center;">
                            <div style="display: flex; gap: 5px; justify-content: center;">
                                <form action="{{ url_for('process_request', request_id=req.id, action='approve') }}" method="POST" onsubmit="return confirm('ì •ë§ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <button type="submit" class="btn main-action-btn" style="padding: 5px 10px; font-size: 0.8em;">ìŠ¹ì¸</button>
                                </form>
                                <form action="{{ url_for('process_request', request_id=req.id, action='reject') }}" method="POST" onsubmit="return confirm('ì •ë§ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <button type="submit" class="btn danger-action-btn" style="padding: 5px 10px; font-size: 0.8em;">ë°˜ë ¤</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; color: #7f8c8d; padding: 30px 0;">
                            í˜„ì¬ ì²˜ë¦¬í•  ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="card" style="flex-grow: 1; display: flex; flex-direction: column;">
        <div class="card-header">
            <span style="color: #2c3e50;">ğŸ“‹ ì²˜ë¦¬ ì™„ë£Œ ë‚´ì—­ (ìµœê·¼ 10ê±´)</span>
        </div>
        
        <div class="card-body" style="flex-grow: 1; overflow-y: auto; padding: 10px 20px;">
            <table class="employee-table" style="background-color: #f9f9f9;">
                <thead>
                    <tr>
                        <th style="width: 15%;">ì‹ ì²­ì¸</th>
                        <th style="width: 10%;">ë¶€ì„œ</th>
                        <th style="width: 10%;">ìœ í˜•</th>
                        <th style="width: 25%;">ê¸°ê°„</th>
                        <th>ì‚¬ìœ </th>
                        <th style="width: 10%;">ì‹ ì²­ì¼</th>
                        <th style="width: 10%; text-align: center;">ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody style="color: #555;">
                {% for req in processed_requests %}
                    <tr>
                        <td>{{ req.name }}</td>
                        <td>{{ req.department }}</td>
                        <td>{{ req.request_type }}</td>
                        <td>{{ req.start_date }} ~ {{ req.end_date }}</td>
                        <td style="text-align: left;">{{ req.reason }}</td>
                        <td>{{ req.request_date.split(' ')[0] }}</td>
                        <td style="text-align: center; font-weight: bold;">
                            {% if req.status == 'ìŠ¹ì¸' %}
                                <span style="color: #2ecc71;">ìŠ¹ì¸ë¨</span>
                            {% else %}
                                <span style="color: #e74c3c;">ë°˜ë ¤ë¨</span>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="7" style="text-align: center; color: #7f8c8d; padding: 50px 0;">
                            ì²˜ë¦¬ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}