{% extends "base.html" %}

{# ë¸Œë¼ìš°ì € íƒ­ ì œëª©ì€ ìƒìœ„ base.htmlì˜ page_title ë¸”ë¡ì„ ë¹„ì›Œì„œ 'ì¸ì‚¬ê´€ë¦¬ ì‹œìŠ¤í…œ'ë§Œ ë‚¨ê¹ë‹ˆë‹¤. #}
{% block title %}{% endblock %} 
{% block page_body_class %}my-attendance-page{% endblock %}

{% block page_content %}

<div class="card" style="grid-column: 1 / 3; grid-row: 1 / 2;">
    <div class="card-header">
        <span>ê¸°ê°„ë³„ ìƒì„¸ ê·¼íƒœ ê¸°ë¡ ì¡°íšŒ</span>
    </div>
    
    <div style="padding: 15px; border-bottom: 1px solid #e0e0e0;">
    <form method="GET" action="{{ url_for('my_attendance') }}">
        <div class="search-filters" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
            
            <span style="font-weight: bold;">ê¸°ê°„:</span>
            <input type="date" name="start_date" style="width: 130px; padding: 8px;" 
                   value="{{ start_date_filter|default('') }}">
            ~
            <input type="date" name="end_date" style="width: 130px; padding: 8px;"
                   value="{{ end_date_filter|default('') }}">

            <span style="font-weight: bold; margin-left: 15px;">ìƒíƒœ:</span>
            <select name="status_filter" style="padding: 8px;">
                <option value="" {% if status_filter_value|default('') == '' %}selected{% endif %}>-- ì „ì²´ --</option>
                <option value="ì •ìƒ" {% if status_filter_value == 'ì •ìƒ' %}selected{% endif %}>ì •ìƒ ì¶œê·¼</option>
                <option value="ì§€ê°" {% if status_filter_value == 'ì§€ê°' %}selected{% endif %}>ì§€ê°</option>
                <option value="íœ´ê°€" {% if status_filter_value == 'íœ´ê°€' %}selected{% endif %}>íœ´ê°€</option>
                <option value="ê²°ê·¼" {% if status_filter_value == 'ê²°ê·¼' %}selected{% endif %}>ê²°ê·¼</option>
            </select>
            
            <div style="margin-left: auto; display: flex; gap: 10px;">
                
                <button type="submit" class="sub-action-btn header-btn" style="background-color: #3498db;">ê²€ìƒ‰</button>
                
                <a href="{{ url_for('my_attendance') }}" class="sub-action-btn header-btn" 
                   style="background-color: #7f8c8d; text-decoration: none;">ì´ˆê¸°í™”</a>
            </div>
        </div>
    </form>
</div>
    <div class="card-body" style="padding: 10px 20px; overflow-y: auto; max-height: 320px; min-height: 320px;"> 
        <table class="employee-table">
            <thead>
                <tr>
                    <th style="width: 15%;">ë‚ ì§œ</th>
                    <th>ì¶œê·¼ ì‹œê°„</th>
                    <th>í‡´ê·¼ ì‹œê°„</th>
                    <th>ì´ ê·¼ë¬´ ì‹œê°„</th>
                    <th style="width: 10%;">ìƒíƒœ</th>
                    <th>ë¹„ê³ </th>
                </tr>
            </thead>
            <tbody>
            {% for record in attendance_records %}
                <tr class="{% if record.status == 'ì§€ê°' %}resigned{% endif %}" style="{% if record.status == 'ì§€ê°' %}color: #e74c3c;{% endif %}">
                    <td>{{ record.date }}</td>
                    <td>{{ record.clock_in|default('-', true) }}</td>
                    <td>{{ record.clock_out|default('-', true) }}</td>
                    <td>{{ record.duration|default('-', true) }}</td>
                    <td>
                        <strong style="color: {% if record.status == 'ì§€ê°' %}#e74c3c{% elif record.status == 'ì •ìƒ' %}#2ecc71{% else %}#7f8c8d{% endif %};">
                            {{ record.status }}
                        </strong>
                    </td>
                    <td>{{ record.note|default('-', true) }}</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; color: #7f8c8d;">ê²€ìƒ‰ëœ ê·¼íƒœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="card" style="grid-column: 1 / 2; grid-row: 2 / 3; height: 380px;">
    <div class="card-header">
        ë‚˜ì˜ ë³µë¬´ ë° í†µê³„ ìš”ì•½
    </div>
    
    <div class="card-body" style="padding: 30px; text-align: center;">
        
        <h2 style="color: #3498db; margin-top: 0; margin-bottom: 30px; font-size: 2.2em;"> 
            ì”ì—¬ ì—°ì°¨: <strong>{{ monthly_stats.remaining_leave|default('N/A') }}ì¼</strong>
        </h2>
        
        <div style="display: flex; justify-content: space-around; margin-top: 40px; text-align: center;">
            
            <div style="width: 45%;">
                <p style="font-size: 1.1em; color: #555; margin: 0 0 5px 0;">ì´ë²ˆ ë‹¬ ì§€ê° íšŸìˆ˜</p> 
                <h3 style="font-size: 2em; color: #e67e22; margin: 0;">{{ monthly_stats.late_count|default(0) }}íšŒ</h3>
            </div>
            
            <div style="width: 45%;">
                <p style="font-size: 1.1em; color: #555; margin: 0 0 5px 0;">ì´ë²ˆ ë‹¬ ì´ˆê³¼ ê·¼ë¬´</p> 
                <h3 style="font-size: 2em; color: #2ecc71; margin: 0;">{{ monthly_stats.overtime_hours|default('0h') }}</h3>
            </div>
            
        </div>

        <a href="#" class="sub-action-btn" style="margin-top: 40px; padding: 10px 20px;">
            ê¸‰ì—¬ ëª…ì„¸ì„œ ì¡°íšŒ ğŸ“„ (í–¥í›„)
        </a>
    </div>
</div>


<div class="card" style="grid-column: 2 / 3; grid-row: 2 / 3; height: 380px;">
    <div class="card-header">
        <span style="flex-grow: 1;">ğŸ—“ï¸ {{ current_month_name }} ê·¼íƒœ ë‹¬ë ¥</span>
        
        <button class="sub-action-btn calendar-nav-btn" 
                onclick="changeMonth({{ current_year }}, {{ current_month | int - 1 }})">
            &lt;
        </button>
        <button class="sub-action-btn calendar-nav-btn" 
                onclick="changeMonth({{ current_year }}, {{ current_month | int + 1 }})">
            &gt;
        </button>
    </div>
    
    <div class="card-body" style="padding: 10px;">
        <div id="attendance-calendar" style="width: 100%;">
            {{ calendar_html | safe }} 
        </div>
    </div>
</div>

{% endblock %}