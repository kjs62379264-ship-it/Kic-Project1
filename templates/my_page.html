{% extends "base.html" %}

{% block title %}ë§ˆì´ í˜ì´ì§€{% endblock %}
{% block page_body_class %}my-page{% endblock %}

{% block page_content %}

<div class="card" style="grid-column: 1 / 3; background-color: #fff; min-height: auto;">
    <div class="card-body" style="display: flex; align-items: center; justify-content: space-between; padding: 20px 20px;">
        
        <div style="display: flex; align-items: baseline; gap: 15px;">
            <h1 style="margin: 0; font-size: 1.3em; color: #2c3e50; line-height: 1;">
                {{ g.user['name'] }} {{ g.user['position'] }}
            </h1>
            <span style="color: #7f8c8d; font-size: 0.9em;">
                | &nbsp; {{ g.user['department'] }} &nbsp; (ì‚¬ë²ˆ: {{ g.user['id'] }})
            </span>
        </div>

        <div>
            <a href="{{ url_for('edit_employee', employee_id=g.user['id']) }}" class="btn sub-action-btn" style="padding: 4px 10px; font-size: 0.8em;">
                âœï¸ ì •ë³´ ìˆ˜ì •
            </a>
        </div>
    </div>
</div>

<div class="card" style="grid-column: 1 / 2;">
    <div class="card-header">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</div>
    <div class="card-body" style="padding: 10px 20px 20px 20px;">
        <table class="employee-table" style="border: none; margin-top: 0;">
            <tr>
                <th style="width: 30%; background: none; border: none; border-bottom: 1px solid #eee;">ì…ì‚¬ì¼</th>
                <td style="border: none; border-bottom: 1px solid #eee;">
                    {{ g.user['hire_date'] }} 
                    <span style="color: #2980b9; font-weight: bold; margin-left: 5px;">
                        {{ tenure_text }}
                    </span>
                </td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ì—°ë½ì²˜</th>
                <td style="border: none; border-bottom: 1px solid #eee;">{{ g.user['phone_number'] }}</td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ì´ë©”ì¼</th>
                <td style="border: none; border-bottom: 1px solid #eee;">{{ g.user['email'] }}</td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ì£¼ì†Œ</th>
                <td style="border: none; border-bottom: 1px solid #eee;">{{ g.user['address'] }}</td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ì„±ë³„</th>
                <td style="border: none; border-bottom: 1px solid #eee;">{{ g.user['gender'] }}</td>
            </tr>
            <tr>
                <th style="background: none; border: none;">ìƒíƒœ</th>
                <td style="border: none;">
                    <span style="color: green; font-weight: bold;">{{ g.user['status'] }}</span>
                </td>
            </tr>
        </table>
    </div>
</div>

<div class="card" style="grid-column: 2 / 3;">
    <div class="card-header">ğŸ’° ê¸‰ì—¬ ë° ê³„ì¢Œ ì •ë³´</div>
    <div class="card-body" style="padding: 10px 20px 20px 20px;">
        <table class="employee-table" style="border: none; margin-top: 0;">
            <tr>
                <th style="width: 30%; background: none; border: none; border-bottom: 1px solid #eee;">ê¸‰ì—¬ ì§€ê¸‰ì¼</th>
                <td style="border: none; border-bottom: 1px solid #eee; font-weight: bold; color: #2c3e50;">
                    ë§¤ì›” 25ì¼
                </td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ì§€ê¸‰ ì€í–‰</th>
                <td style="border: none; border-bottom: 1px solid #eee;">
                    {{ contract['bank_name'] if contract else '-' }}
                </td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ê³„ì¢Œ ë²ˆí˜¸</th>
                <td style="border: none; border-bottom: 1px solid #eee;">
                    {{ contract['account_number'] if contract else '-' }}
                </td>
            </tr>
            <tr>
                <th style="background: none; border: none; border-bottom: 1px solid #eee;">ê³„ì•½ ì—°ë´‰</th>
                <td style="border: none; border-bottom: 1px solid #eee;">
                    {% if contract %}
                        <span class="security-blur" onclick="this.classList.toggle('revealed')" style="cursor: pointer;">
                            <span class="hidden-text">****** ì›</span>
                            <span class="real-text" style="display: none; color: #2980b9; font-weight: bold;">
                                {{ contract['annual_salary']|comma }} ì›
                            </span>
                        </span>
                        <span style="font-size: 0.8em; color: #999;">(í´ë¦­)</span>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th style="background: none; border: none;">ì›” ê¸°ë³¸ê¸‰</th>
                <td style="border: none;">
                    {% if contract %}
                        <span class="security-blur" onclick="this.classList.toggle('revealed')" style="cursor: pointer;">
                            <span class="hidden-text">****** ì›</span>
                            <span class="real-text" style="display: none; color: #2980b9; font-weight: bold;">
                                {{ contract['base_salary']|comma }} ì›
                            </span>
                        </span>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
        </table>
        <div style="margin-top: 20px; text-align: right;">
            <a href="{{ url_for('my_salary') }}" class="sub-action-btn" style="font-size: 0.9em;">
                ê¸‰ì—¬ ëª…ì„¸ì„œ ì „ì²´ ë³´ê¸° >
            </a>
        </div>
    </div>
</div>

<div class="card" style="grid-column: 1 / 3;">
    <div class="card-header">ğŸ“Š ë‚˜ì˜ ê·¼íƒœ í˜„í™© ìš”ì•½</div>
    
    <div class="card-body" style="padding: 0; display: flex; flex-direction: column;">
        
        <div style="display: flex; flex: 1; border-bottom: 1px solid #eee;">
            
            <div style="flex: 1; padding: 25px; border-right: 1px solid #eee;">
                <h4 style="margin-top: 0; margin-bottom: 10px; color: #333; text-align: center; font-size: 1.1em;">ğŸ“… ì´ë²ˆ ë‹¬</h4>
                
                <div style="display: flex; flex-direction: column; gap: 15px; font-size: 0.95em; color: #555;">
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ì§€ê° / ê²°ê·¼</span> 
                        <span style="font-size: 1.1em;">
                            <strong style="color: #333;">{{ monthly_stats.late_count }}íšŒ</strong>
                            <span style="color: #ccc; margin: 0 5px;">|</span>
                            <strong style="color: #333;">{{ monthly_stats.absent_count }}íšŒ</strong>
                        </span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ì´ˆê³¼ê·¼ë¬´ (ì‹œê°„ / ì¼ìˆ˜)</span> 
                        <span style="font-size: 1.1em;">
                            <strong style="color: #333;">{{ monthly_stats.overtime_hours }}</strong>
                            <span style="color: #ccc; margin: 0 5px;">|</span>
                            <strong style="color: #333;">{{ monthly_stats.overtime_days }}ì¼</strong>
                        </span>
                    </div>

                </div>
            </div>

            <div style="flex: 1; padding: 25px;">
                <h4 style="margin-top: 0; margin-bottom: 10px; color: #7f8c8d; text-align: center; font-size: 1.1em;">ğŸ“† ì˜¬í•´ ëˆ„ì </h4>
                
                <div style="display: flex; flex-direction: column; gap: 15px; font-size: 0.95em; color: #7f8c8d;">
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ì§€ê° / ê²°ê·¼</span> 
                        <span style="font-size: 1.1em;">
                            <strong>{{ yearly_stats.late_count }}íšŒ</strong>
                            <span style="color: #eee; margin: 0 5px;">|</span>
                            <strong>{{ yearly_stats.absent_count }}íšŒ</strong>
                        </span>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ì´ˆê³¼ê·¼ë¬´ (ì‹œê°„ / ì¼ìˆ˜)</span> 
                        <span style="font-size: 1.1em;">
                            <strong>{{ yearly_stats.overtime_hours }}</strong>
                            <span style="color: #eee; margin: 0 5px;">|</span>
                            <strong>{{ yearly_stats.overtime_days }}ì¼</strong>
                        </span>
                    </div>

                </div>
            </div>
        </div>

        <div style="padding: 15px 20px; text-align: center; background-color: #fafafa;"> 
            <div style="font-size: 1em; color: #555; margin-bottom: 10px;">ì”ì—¬ ì—°ì°¨</div> 
            <div style="font-size: 2.5em; font-weight: bold; color: #2c3e50; line-height: 1;">
                {{ remaining_leave }} <span style="font-size: 0.5em; color: #999; font-weight: normal;">ì¼</span>
            </div>
            
            <a href="{{ url_for('vacation_request') }}" style="display: inline-block; margin-top: 10px; font-size: 0.9em; color: #999; text-decoration: none; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; background-color: white; transition: background-color 0.2s;">
                íœ´ê°€ ì‹ ì²­í•˜ê¸° &gt;
            </a>
        </div>

    </div>
</div>

<script>
    // ì—°ë´‰ ì •ë³´ í´ë¦­ ì‹œ í† ê¸€ ê¸°ëŠ¥
    document.querySelectorAll('.security-blur').forEach(item => {
        item.addEventListener('click', function() {
            const hidden = this.querySelector('.hidden-text');
            const real = this.querySelector('.real-text');
            
            if (real.style.display === 'none') {
                real.style.display = 'inline';
                hidden.style.display = 'none';
            } else {
                real.style.display = 'none';
                hidden.style.display = 'inline';
            }
        });
    });
</script>

{% endblock %}