{% extends "base.html" %}

{% block page_content %}
<div class="card" style="grid-column: 1 / -1;">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        
        <div style="display: flex; align-items: center; gap: 15px;">
            <span style="font-size: 1.1em; font-weight: bold;">ğŸ’° {{ year }}ë…„ {{ month }}ì›” ê¸‰ì—¬ ëŒ€ì¥</span>
            
            <form method="GET" action="{{ url_for('salary_payroll') }}" style="display: flex; gap: 5px; align-items: center;">
                <select name="year" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                    {% for y in range(2024, 2027) %}
                    <option value="{{ y }}" {% if year == y %}selected{% endif %}>{{ y }}ë…„</option>
                    {% endfor %}
                </select>
                <select name="month" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if month == m %}selected{% endif %}>{{ m }}ì›”</option>
                    {% endfor %}
                </select>
                <button type="submit" class="sub-action-btn header-btn" style="padding: 5px 10px;">ì´ë™</button>
            </form>
        </div>
        
        <div style="display: inline-block;">
            {% if is_calculated %}
            <a href="{{ url_for('download_salary_excel', year=year, month=month) }}" class="btn sub-action-btn" style="background-color: #27ae60; color: white; margin-right: 10px;">
                ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
            </a>
            {% endif %}

            {% if not is_calculated %}
            <form action="{{ url_for('calculate_all_salary') }}" method="POST" style="display:inline;">
                <button type="submit" class="btn main-action-btn">âš¡ ì¼ê´„ ê³„ì‚° ë° ëŒ€ì¥ ìƒì„±</button>
            </form>
            {% else %}
            <form action="{{ url_for('calculate_all_salary') }}" method="POST" style="display:inline;" onsubmit="return confirm('ì´ë¯¸ ìƒì„±ëœ ëŒ€ì¥ì´ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ê³„ì‚°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                <button type="submit" class="btn sub-action-btn">ğŸ”„ ì¬ê³„ì‚°</button>
            </form>
            {% endif %}
        </div>
    </div>

    <div class="card-body">
        <table class="employee-table">
            <thead>
                <tr>
                    <th>ì‚¬ë²ˆ</th>
                    <th>ì´ë¦„</th>
                    <th>ë¶€ì„œ</th>
                    <th>ê¸°ë³¸ê¸‰</th>
                    <th>ìˆ˜ë‹¹</th>
                    <th style="background-color: #eaf2f8;">ì•¼ê·¼ìˆ˜ë‹¹</th> <th>ê³µì œì´ì•¡</th>
                    <th>ì‹¤ìˆ˜ë ¹ì•¡</th>
                    <th>ì§€ê¸‰ì¼</th>
                </tr>
            </thead>
            <tbody>
            {% for pay in payrolls %}
                <tr>
                    <td>{{ pay.employee_id }}</td>
                    <td>{{ pay.name }}</td>
                    <td>{{ pay.department }}</td>
                    <td style="text-align: right;">{{ pay.total_base|comma }}</td>
                    <td style="text-align: right;">{{ pay.total_allowance|comma }}</td>
                    
                    <td style="text-align: right; color: #2980b9; background-color: #f4f8fb; font-weight: bold;">
                        {{ pay.overtime_pay|comma }}
                    </td>
                    
                    <td style="text-align: right; color: #e74c3c;">{{ pay.total_deduction|comma }}</td>
                    <td style="text-align: right; color: #2ecc71; font-weight: bold;">{{ pay.net_salary|comma }}</td>
                    <td style="text-align: center;">{{ pay.payment_date }}</td>
                </tr>
            {% else %}
                <tr><td colspan="9" style="text-align:center; padding: 30px; color: #7f8c8d;">ì•„ì§ ìƒì„±ëœ ê¸‰ì—¬ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}