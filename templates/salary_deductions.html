{% extends "base.html" %}

{% block title %}급여 공제 항목 관리{% endblock %}

{% block page_content %}
<div class="card" style="grid-column: 1 / -1;">
    <div class="card-header">
        <span>직원별 고정 공제 관리 (기숙사비, 사우회비 등)</span>
        <small style="margin-left: 10px; color: #666;">※ 4대보험/세금 외에 추가로 차감할 금액을 설정합니다.</small>
    </div>
    <div class="card-body">
        <table class="employee-table">
            <thead>
                <tr>
                    <th style="width: 15%;">직원 정보</th>
                    <th style="width: 50%;">현재 공제 항목 리스트</th>
                    <th style="width: 35%;">새 항목 추가</th>
                </tr>
            </thead>
            <tbody>
            {% for emp in employees %}
            <tr>
                <td style="vertical-align: top; padding-top: 15px;">
                    <strong>{{ emp.name }}</strong><br>
                    <span style="font-size: 0.9em; color: #555;">{{ emp.department }} {{ emp.position }}</span><br>
                    <span style="font-size: 0.8em; color: #999;">({{ emp.id }})</span>
                </td>
                
                <td style="vertical-align: top;">
                    {% set items = deduction_map[emp.id] %}
                    {% if items %}
                        <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for item in items %}
                            <li style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 5px 0;">
                                <span>{{ item.deduction_name }} : <strong style="color: #e74c3c;">-{{ item.amount|comma }}원</strong></span>
                                <form action="{{ url_for('delete_deduction', deduction_id=item.id) }}" method="POST" style="display: inline;">
                                    <button type="submit" class="delete-notice-btn" onclick="return confirm('삭제하시겠습니까?');">X</button>
                                </form>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <span style="color: #ccc;">등록된 추가 공제가 없습니다.</span>
                    {% endif %}
                </td>
                
                <td style="vertical-align: top; background-color: #f9f9f9;">
                    <form action="{{ url_for('add_deduction') }}" method="POST" style="display: flex; gap: 5px; align-items: center;">
                        <input type="hidden" name="employee_id" value="{{ emp.id }}">
                        <input type="text" name="deduction_name" placeholder="항목명 (예: 사우회비)" required style="width: 140px; font-size: 0.9em;">
                        <input type="text" name="amount" placeholder="금액" required style="width: 100px; text-align: right; font-size: 0.9em;">
                        <button type="submit" class="btn sub-action-btn" style="padding: 5px 10px; font-size: 0.9em;">추가</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}